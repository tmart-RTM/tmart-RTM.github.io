<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Instruction - Advanced Modelling &mdash; T-Mart 2.4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=184e8d39" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=de1351e5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Instruction - Modelling Sea-Surface Reflectance factor" href="ins_rho.html" />
    <link rel="prev" title="Instruction - Basic Modelling" href="ins_basic.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            T-Mart
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="ins_aec.html">Instruction - Adjacency-Effect Correction</a></li>
<li class="toctree-l1"><a class="reference internal" href="ins_basic.html">Instruction - Basic Modelling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Instruction - Advanced Modelling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#be-creative-at-what-you-can-do">Be creative at what you can do!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#built-in-surface-types">Built-in surface types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#case-study-a-typical-ocean-colour-observation">Case study: a typical ocean-colour observation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#case-study-adjacency-effect-modelling">Case study: adjacency-effect modelling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#d-surfaces">3D surfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#useful-information">Useful information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ins_rho.html">Instruction - Modelling Sea-Surface Reflectance factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="tmart.html">Parameters</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">T-Mart</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Instruction - Advanced Modelling</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="instruction-advanced-modelling">
<h1>Instruction - Advanced Modelling<a class="headerlink" href="#instruction-advanced-modelling" title="Link to this heading"></a></h1>
<p>This page introduces spectral and 3D radiative-transfer calculations.</p>
<section id="be-creative-at-what-you-can-do">
<h2>Be creative at what you can do!<a class="headerlink" href="#be-creative-at-what-you-can-do" title="Link to this heading"></a></h2>
<p>You can do lots of things with T-Mart! E.g.:</p>
<ul class="simple">
<li><p>Load your own DEM and image (they have to be the same size),</p></li>
<li><p>Loop through wavelengths, distances from shore, AOT, viewing or solar angles, etc.</p></li>
</ul>
</section>
<section id="built-in-surface-types">
<h2>Built-in surface types<a class="headerlink" href="#built-in-surface-types" title="Link to this heading"></a></h2>
<p>T-Mart currently provides four built-in spectral surface types: soil, vegetation, water and water with a chlorophyll concentration of 1 µg/L. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create object</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">SpectralSurface</span><span class="p">(</span><span class="s1">&#39;water_chl1&#39;</span><span class="p">)</span>

<span class="c1"># Find spectral reflectance at 400nm</span>
<span class="n">water</span><span class="o">.</span><span class="n">wl</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>

<span class="c1"># Create a spectral surface in a numpy array </span>
<span class="n">wl</span> <span class="o">=</span> <span class="mi">400</span> <span class="c1"># your variable in a loop</span>
<span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">water</span><span class="o">.</span><span class="n">wl</span><span class="p">(</span><span class="n">wl</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="case-study-a-typical-ocean-colour-observation">
<h2>Case study: a typical ocean-colour observation<a class="headerlink" href="#case-study-a-typical-ocean-colour-observation" title="Link to this heading"></a></h2>
<p>Here we model a typical hyperspectral ocean-colour observation with the following parameters:</p>
<ul class="simple">
<li><p>View zenith = 30°</p></li>
<li><p>Solar zenith = 30°</p></li>
<li><p>View azimuthal = 90° (to minimize sun-glint)</p></li>
<li><p>Windspeed = 10 m/s</p></li>
<li><p>Atmosphere profile: mid-latitude summer</p></li>
<li><p>Aerosol profile: maritime aerosols</p></li>
<li><p>AOT550: 0.1</p></li>
<li><p>Water salinity: 35 parts per thousand</p></li>
<li><p>Water temperature: 20 C</p></li>
<li><p>Water chl-a concentration: 1 µg/L</p></li>
</ul>
<p>Water’s specular reflectance is calculated following Cox&amp;Munk slope statistics.</p>
<p>We loop through wavelengths 400 to 1100nm at an interval of 10nm, use a Python list to collect the reflectances at each wavelength, convert it to a Pandas dataframe, and plot the reflectances with the <em>matplotlib</em> package:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tmart</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">Py6S.Params.atmosprofile</span> <span class="kn">import</span> <span class="n">AtmosProfile</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
	<span class="n">water</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">SpectralSurface</span><span class="p">(</span><span class="s1">&#39;water_chl1&#39;</span><span class="p">)</span>
	
	<span class="c1"># Master output</span>
	<span class="n">pd_output</span> <span class="o">=</span> <span class="p">[]</span>
	
	<span class="c1"># Specify wavelength in nm</span>
	<span class="n">wavelengths</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">1110</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
	
	<span class="k">for</span> <span class="n">wl</span> <span class="ow">in</span> <span class="n">wavelengths</span><span class="p">:</span>
	
	    <span class="c1">### DEM and reflectance ###</span>
	    
	    <span class="c1"># Three same-size numpy arrays are needed</span>
	    <span class="n">image_DEM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># in meters</span>
	    <span class="n">image_reflectance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">water</span><span class="o">.</span><span class="n">wl</span><span class="p">(</span><span class="n">wl</span><span class="p">))</span> <span class="c1"># unitless       </span>
	    <span class="n">image_isWater</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># 1 is water, 0 is land</span>
	    
	    <span class="c1"># pixel width and length, in meters </span>
	    <span class="n">cell_size</span> <span class="o">=</span> <span class="mi">20_000</span> 
	    
	    <span class="c1"># Synthesize a surface object</span>
	    <span class="n">my_surface</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">image_DEM</span><span class="p">,</span><span class="n">image_reflectance</span><span class="p">,</span><span class="n">image_isWater</span><span class="p">,</span><span class="n">cell_size</span><span class="p">)</span>  
	    <span class="c1"># Set background information, 1 or 2 background surfaces can be set;</span>
	    <span class="c1"># If 2: the first background is the one closer to [0,0]</span>
	    <span class="n">my_surface</span><span class="o">.</span><span class="n">set_background</span><span class="p">(</span><span class="n">bg_ref</span>        <span class="o">=</span> <span class="p">[</span><span class="n">water</span><span class="o">.</span><span class="n">wl</span><span class="p">(</span><span class="n">wl</span><span class="p">),</span><span class="n">water</span><span class="o">.</span><span class="n">wl</span><span class="p">(</span><span class="n">wl</span><span class="p">)],</span> 
	                              <span class="n">bg_isWater</span>    <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="c1"># water</span>
	                              <span class="n">bg_elevation</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># elevation of both background</span>
	                              <span class="n">bg_coords</span>     <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">]])</span> <span class="c1"># a line dividing two background                                    </span>
	    
	    <span class="c1">### Atmosphere ###</span>
	    
	    <span class="c1"># Atmophere profile comes from 6S</span>
	    <span class="n">atm_profile</span> <span class="o">=</span> <span class="n">AtmosProfile</span><span class="o">.</span><span class="n">PredefinedType</span><span class="p">(</span><span class="n">AtmosProfile</span><span class="o">.</span><span class="n">MidlatitudeSummer</span><span class="p">)</span> 
	    <span class="n">aerosol_type</span> <span class="o">=</span> <span class="s1">&#39;Maritime&#39;</span> 
	    <span class="n">aot550</span> <span class="o">=</span> <span class="mf">0.1</span>
	    <span class="n">n_layers</span> <span class="o">=</span> <span class="mi">20</span>
	    <span class="n">aerosol_scale_height</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># in km</span>
	    
	    <span class="c1"># Synthesize an atmosphere object    </span>
	    <span class="n">my_atm</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">Atmosphere</span><span class="p">(</span><span class="n">atm_profile</span><span class="p">,</span> <span class="n">aot550</span><span class="p">,</span> <span class="n">aerosol_type</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">aerosol_scale_height</span><span class="p">)</span>   
	        
	    <span class="c1">### Running T-Mart ###</span>
	    
	    <span class="c1"># Make a T-Mart object </span>
	    <span class="n">my_tmart</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">Tmart</span><span class="p">(</span><span class="n">Surface</span> <span class="o">=</span> <span class="n">my_surface</span><span class="p">,</span> <span class="n">Atmosphere</span><span class="o">=</span> <span class="n">my_atm</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	    <span class="n">my_tmart</span><span class="o">.</span><span class="n">set_wind</span><span class="p">(</span><span class="n">wind_speed</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">wind_azi_avg</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
	    <span class="n">my_tmart</span><span class="o">.</span><span class="n">set_water</span><span class="p">(</span><span class="n">water_salinity</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">water_temperature</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
	    
	    <span class="c1"># Specify the sensor&#39;s position (x, y, z), viewing direction relative </span>
	    <span class="c1"># to the sensor (zenith, azimuth), sun&#39;s direction relative to the target </span>
	    <span class="c1"># (zenith, azimuth)</span>
	    <span class="n">my_tmart</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">sensor_coords</span><span class="o">=</span><span class="p">[</span><span class="mi">51</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">130_000</span><span class="p">],</span> 
	                          <span class="n">target_pt_direction</span><span class="o">=</span><span class="p">[</span><span class="mi">150</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span>
	                          <span class="n">sun_dir</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
	    
	    <span class="c1"># Run</span>
	    <span class="n">n_photon</span> <span class="o">=</span> <span class="mi">10_000</span>
	    <span class="n">results</span> <span class="o">=</span> <span class="n">my_tmart</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">n_photon</span><span class="o">=</span><span class="n">n_photon</span><span class="p">)</span>
	    
	    <span class="c1"># Calculate reflectances using recorded photon information </span>
	    <span class="n">R</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">calc_ref</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
	    
	    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">R</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
	        <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;     &#39;</span> <span class="p">,</span> <span class="n">v</span><span class="p">)</span>
	        
	    <span class="c1"># Add wavelength and append to output </span>
	    <span class="n">R</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wl</span>
	    <span class="n">pd_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
	
	<span class="n">pd_output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pd_output</span><span class="p">)</span>
	
	<span class="c1"># Plot </span>
	<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
	
	<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pd_output</span><span class="p">[</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">],</span> <span class="n">pd_output</span><span class="p">[</span><span class="s2">&quot;R_atm&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Atmospheric intrinsic R.&#39;</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pd_output</span><span class="p">[</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">],</span> <span class="n">pd_output</span><span class="p">[</span><span class="s2">&quot;R_dir&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Direct R.&#39;</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pd_output</span><span class="p">[</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">],</span> <span class="n">pd_output</span><span class="p">[</span><span class="s2">&quot;R_env&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Environmental R.&#39;</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pd_output</span><span class="p">[</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">],</span> <span class="n">pd_output</span><span class="p">[</span><span class="s2">&quot;R_total&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total R.&#39;</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	
	<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Output:</p>
<p><img alt="waterTOA" src="_images/waterTOA.png" /></p>
<p>There is non-negligible reflectance in the NIR range, and that comes from glint and foam reflectance at a wind speed of 10 m/s.</p>
<p>Note that because T-Mart runs wavelength by wavelength and Monte-Carlo solvers are usually slower than other numerical solvers, the code above may take over 10 minutes to run.</p>
</section>
<section id="case-study-adjacency-effect-modelling">
<h2>Case study: adjacency-effect modelling<a class="headerlink" href="#case-study-adjacency-effect-modelling" title="Link to this heading"></a></h2>
<p>Here I demonstrate a simple straight-line-coast adjacency-effect modelling using two built-in spectral libraries in T-Mart, <em>water_chl1</em> and <em>vegetation</em>, representing ocean water with a chlorophyll concentration of 1 mg/m<sup>3</sup> and land of vegetation, respectively.</p>
<p>Modelling of the adjacency effect at 800 nm, 1000 m from the shore:</p>
<img src="_images/AE.png"  width="500">
<p>Note that the coast extends to infinity in the modelling by setting the background in T-Mart. The blue line is the surface normal sampled from Cox-Munk slope statistics. The colour of the dark triangles represents the low reflectance of water at 800 nm.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tmart</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">Py6S.Params.atmosprofile</span> <span class="kn">import</span> <span class="n">AtmosProfile</span>

<span class="c1"># Specify wavelength in nm</span>
<span class="n">wl</span> <span class="o">=</span> <span class="mi">800</span>

<span class="c1"># Distance to shore in m </span>
<span class="n">dist</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Built-in spectral libraries </span>
<span class="n">water</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">SpectralSurface</span><span class="p">(</span><span class="s1">&#39;water_chl1&#39;</span><span class="p">)</span>
<span class="n">vegetation</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">SpectralSurface</span><span class="p">(</span><span class="s1">&#39;vegetation&#39;</span><span class="p">)</span>


<span class="c1">### DEM and reflectance ###</span>

<span class="c1"># Three same-size numpy arrays are needed</span>
<span class="n">image_DEM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># in meters</span>
<span class="n">image_reflectance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">vegetation</span><span class="o">.</span><span class="n">wl</span><span class="p">(</span><span class="n">wl</span><span class="p">),</span><span class="n">vegetation</span><span class="o">.</span><span class="n">wl</span><span class="p">(</span><span class="n">wl</span><span class="p">)],</span>
                              <span class="p">[</span><span class="n">water</span><span class="o">.</span><span class="n">wl</span><span class="p">(</span><span class="n">wl</span><span class="p">),</span><span class="n">water</span><span class="o">.</span><span class="n">wl</span><span class="p">(</span><span class="n">wl</span><span class="p">)]])</span> 
<span class="n">image_isWater</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>

<span class="c1"># pixel width and length, in meters </span>
<span class="n">cell_size</span> <span class="o">=</span> <span class="mi">20_000</span>

<span class="c1"># Synthesize a surface object</span>
<span class="n">my_surface</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">image_DEM</span><span class="p">,</span><span class="n">image_reflectance</span><span class="p">,</span><span class="n">image_isWater</span><span class="p">,</span><span class="n">cell_size</span><span class="p">)</span>  
<span class="c1"># Set background information, 1 or 2 background surfaces can be set;</span>
<span class="c1"># If 2: the first background is the one closer to [0,0]</span>
<span class="n">my_surface</span><span class="o">.</span><span class="n">set_background</span><span class="p">(</span><span class="n">bg_ref</span>        <span class="o">=</span> <span class="p">[</span><span class="n">vegetation</span><span class="o">.</span><span class="n">wl</span><span class="p">(</span><span class="n">wl</span><span class="p">),</span><span class="n">water</span><span class="o">.</span><span class="n">wl</span><span class="p">(</span><span class="n">wl</span><span class="p">)],</span> 
                          <span class="n">bg_isWater</span>    <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="c1"># water</span>
                          <span class="n">bg_elevation</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># elevation of both background</span>
                          <span class="n">bg_coords</span>     <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20_000</span><span class="p">],[</span><span class="mi">40_000</span><span class="p">,</span><span class="mi">20_000</span><span class="p">]])</span> <span class="c1"># a line dividing two background                                    </span>

<span class="c1">### Atmosphere ###</span>

<span class="c1"># Atmophere profile comes from 6S</span>
<span class="n">atm_profile</span> <span class="o">=</span> <span class="n">AtmosProfile</span><span class="o">.</span><span class="n">PredefinedType</span><span class="p">(</span><span class="n">AtmosProfile</span><span class="o">.</span><span class="n">MidlatitudeSummer</span><span class="p">)</span> 
<span class="n">aerosol_type</span> <span class="o">=</span> <span class="s1">&#39;Maritime&#39;</span> 
<span class="n">aot550</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># Synthesize an atmosphere object    </span>
<span class="n">my_atm</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">Atmosphere</span><span class="p">(</span><span class="n">atm_profile</span><span class="p">,</span> <span class="n">aot550</span><span class="p">,</span> <span class="n">aerosol_type</span><span class="p">)</span>   

<span class="c1">### Running T-Mart ###</span>

<span class="c1"># Make a T-Mart object </span>
<span class="n">my_tmart</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">Tmart</span><span class="p">(</span><span class="n">Surface</span> <span class="o">=</span> <span class="n">my_surface</span><span class="p">,</span> <span class="n">Atmosphere</span><span class="o">=</span> <span class="n">my_atm</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">my_tmart</span><span class="o">.</span><span class="n">set_wind</span><span class="p">(</span><span class="n">wind_speed</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">wind_azi_avg</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">my_tmart</span><span class="o">.</span><span class="n">set_water</span><span class="p">(</span><span class="n">water_salinity</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">water_temperature</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Specify the sensor&#39;s position (x, y, z), viewing direction relative </span>
<span class="c1"># to the sensor (zenith, azimuth), sun&#39;s direction relative to the target </span>
<span class="c1"># (zenith, azimuth)</span>
<span class="n">my_tmart</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">target_coords</span><span class="o">=</span><span class="p">[</span><span class="mi">30000</span><span class="p">,</span><span class="mi">20000</span><span class="o">+</span><span class="n">dist</span><span class="p">],</span> 
                      <span class="n">target_pt_direction</span><span class="o">=</span><span class="p">[</span><span class="mi">150</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">sun_dir</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">90</span><span class="p">])</span>  

<span class="c1"># Run single photon and plot </span>
<span class="c1"># results = my_tmart.run_plot(wl=wl, plot_on=True, plot_range=[0,100_000,0,100_000,0,100_000])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    
    <span class="n">n_photon</span> <span class="o">=</span> <span class="mi">100_000</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">my_tmart</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">n_photon</span><span class="o">=</span><span class="n">n_photon</span><span class="p">)</span>
    
    <span class="c1"># Calculate reflectances using recorded photon information </span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">calc_ref</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">R</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;     &#39;</span> <span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<p>You might want to edit parameters in the code to suit your needs, important parameters include wavelength, distance to shore, aerosol type and AOT, solar and viewing geometry, etc. One can also import imagery as numpy array to model more complex shorelines and surfaces.</p>
</section>
<section id="d-surfaces">
<h2>3D surfaces<a class="headerlink" href="#d-surfaces" title="Link to this heading"></a></h2>
<p>To simulate non-flat surfaces, all we need to do is to have non-zero values in the DEM array. Users can import DEMs from rasters through geo-processing packages such as GDAL. For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">image_DEM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">30_000</span><span class="p">,</span><span class="mi">20_000</span><span class="p">],[</span><span class="mi">5_000</span><span class="p">,</span><span class="mi">10_000</span><span class="p">]])</span> <span class="c1"># in meters</span>
</pre></div>
</div>
<p>You can visualize the surface in a single-photon run before calculating the reflective properties of the entire system in a multi-photon run:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tmart</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">Py6S.Params.atmosprofile</span> <span class="kn">import</span> <span class="n">AtmosProfile</span>

<span class="c1"># Specify wavelength in nm</span>
<span class="n">wl</span> <span class="o">=</span> <span class="mi">800</span>

<span class="c1">### DEM and reflectance ###</span>

<span class="c1"># Three same-size numpy arrays are needed</span>
<span class="n">image_DEM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">30_000</span><span class="p">,</span><span class="mi">20_000</span><span class="p">],[</span><span class="mi">5_000</span><span class="p">,</span><span class="mi">10_000</span><span class="p">]])</span> <span class="c1"># in meters</span>
<span class="n">image_reflectance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]])</span>  <span class="c1"># unitless     </span>
<span class="n">image_isWater</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># 1 is water, 0 is land</span>

<span class="c1"># pixel width and length, in meters </span>
<span class="n">cell_size</span> <span class="o">=</span> <span class="mi">20_000</span> 

<span class="c1"># Synthesize a surface object</span>
<span class="n">my_surface</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">DEM</span> <span class="o">=</span> <span class="n">image_DEM</span><span class="p">,</span>
                           <span class="n">reflectance</span> <span class="o">=</span> <span class="n">image_reflectance</span><span class="p">,</span>
                           <span class="n">isWater</span> <span class="o">=</span> <span class="n">image_isWater</span><span class="p">,</span>
                           <span class="n">cell_size</span> <span class="o">=</span> <span class="n">cell_size</span><span class="p">)</span>  

<span class="c1">### Atmosphere ###</span>

<span class="c1"># Atmophere profile comes from 6S</span>
<span class="n">atm_profile</span> <span class="o">=</span> <span class="n">AtmosProfile</span><span class="o">.</span><span class="n">PredefinedType</span><span class="p">(</span><span class="n">AtmosProfile</span><span class="o">.</span><span class="n">MidlatitudeSummer</span><span class="p">)</span> 

<span class="c1"># Synthesize an atmosphere object </span>
<span class="n">my_atm</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">Atmosphere</span><span class="p">(</span><span class="n">atm_profile</span><span class="p">)</span>

<span class="c1">### Running T-Mart ###</span>

<span class="c1"># Make a T-Mart object </span>
<span class="n">my_tmart</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">Tmart</span><span class="p">(</span><span class="n">Surface</span> <span class="o">=</span> <span class="n">my_surface</span><span class="p">,</span> <span class="n">Atmosphere</span><span class="o">=</span> <span class="n">my_atm</span><span class="p">)</span>

<span class="c1"># Specify the sensor&#39;s position (x, y, z), viewing direction relative </span>
<span class="c1"># to the sensor (zenith, azimuth), sun&#39;s direction relative to the target </span>
<span class="c1"># (zenith, azimuth)</span>
<span class="n">my_tmart</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">sensor_coords</span><span class="o">=</span><span class="p">[</span><span class="mi">51</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">130_000</span><span class="p">],</span> 
                      <span class="n">target_pt_direction</span><span class="o">=</span><span class="p">[</span><span class="mi">180</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">sun_dir</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

	<span class="c1"># Run and plot on a separate window</span>
	<span class="o">%</span><span class="n">matplotlib</span> <span class="n">qt</span>
	<span class="n">results</span> <span class="o">=</span> <span class="n">my_tmart</span><span class="o">.</span><span class="n">run_plot</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="n">wl</span><span class="p">,</span> <span class="n">plot_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">100_000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100_000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100_000</span><span class="p">])</span>
	
	<span class="c1"># Calculate reflectances using recorded photon information </span>
	<span class="n">R</span> <span class="o">=</span> <span class="n">tmart</span><span class="o">.</span><span class="n">calc_ref</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">R</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
	    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;     &#39;</span> <span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<img src="_images/3D_surface.png"  width="500">
</section>
<section id="useful-information">
<h2>Useful information<a class="headerlink" href="#useful-information" title="Link to this heading"></a></h2>
<p>The following two dataframes completely describe the atmosphere at a single wavelength in T-Mart.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Running T-Mart at a specific wavelength will generate </span>
<span class="c1"># an atmosphere at that wavelength in the Tmart object</span>
<span class="n">my_tmart</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">wl</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

<span class="c1"># The atmosphere profile</span>
<span class="n">my_atm_profile</span> <span class="o">=</span> <span class="n">my_tmart</span><span class="o">.</span><span class="n">atm_profile_wl</span>

<span class="c1"># The aerosol scattering phase function</span>
<span class="n">my_aerosol_SPF</span> <span class="o">=</span> <span class="n">my_tmart</span><span class="o">.</span><span class="n">aerosol_SPF_wl</span>
</pre></div>
</div>
<p>The columns of the atmosphere profile:</p>
<ul class="simple">
<li><p>Alt_bottom: the bottom the the layer in km.</p></li>
<li><p>Alt_top: the top of the layer in km.</p></li>
<li><p>ot_abs: optical thickness of absroption.</p></li>
<li><p>ot_rayleigh: optical thickness of molecular or rayleigh scattering. No scattering phase function needed because it is built-in.</p></li>
<li><p>ot_mie: optical thickness of aerosol scattering, relies on the input scattering phase function (see below).</p></li>
<li><p>ot_scatt: sum of ot_rayleigh and ot_mie.</p></li>
</ul>
<p>The columns of the aerosol scattering phase function (currently rely on pre-calculated values, may use miepython in the future to compute on the go):</p>
<ul class="simple">
<li><p>Angle: the scattering angle.</p></li>
<li><p>Value: normalized intensity at the corresponding scattering angle.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ins_basic.html" class="btn btn-neutral float-left" title="Instruction - Basic Modelling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ins_rho.html" class="btn btn-neutral float-right" title="Instruction - Modelling Sea-Surface Reflectance factor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Yulun Wu.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>