

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Instruction - Adjacency-Effect Correction &mdash; T-Mart 2.5.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=401c948e" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=0bbe9fa5"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Instruction - Basic Modelling" href="ins_basic.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            T-Mart
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Instruction - Adjacency-Effect Correction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mininum-input">Mininum input</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overwrite-existing-files">Overwrite existing files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ancillary-and-log-files">Ancillary and log files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aec-configuration">AEC configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#additional-arguments">Additional arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#user-input-atmospheric-information">User-input atmospheric information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#assumptions-in-aec">Assumptions in AEC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prisma-image-processing">PRISMA image processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#video-tutorials">Video tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ins_basic.html">Instruction - Basic Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="ins_advanced.html">Instruction - Advanced Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="ins_rho.html">Instruction - Modelling Sea-Surface Reflectance factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="tmart.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">T-Mart</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Instruction - Adjacency-Effect Correction</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="instruction-adjacency-effect-correction">
<h1>Instruction - Adjacency-Effect Correction<a class="headerlink" href="#instruction-adjacency-effect-correction" title="Link to this heading"></a></h1>
<section id="mininum-input">
<h2>Mininum input<a class="headerlink" href="#mininum-input" title="Link to this heading"></a></h2>
<p>The <em>AEC.run</em> function is used to perform adjacency-effect correction (AEC) in T-Mart. Correction is performed directly on level-1 products, and the output is adjacency-effect-free top-of-atmosphere products in the same format as the input level-1 products, therefore this workflow can be followed by any amtospheric correction tools. Currently it supports Sentinel-2 MSI, Landsat 8/9 OLI/OLI-2 and PRISMA imagery.</p>
<p>NASA EarthData credentials are needed to retrieve ozone, water vapour, and aerosol optical thickness and composition for accurate AEC. You may need to approve OB.DAAC Data Access in your <a href="https://urs.earthdata.nasa.gov/profile" target="_blank">EarthData account</a>: click <em>Authorized Apps</em> under the <em>Applications</em> tab - click the <em>APPROVE MORE APPLICATIONS</em> button near the bottom, and authorize <em>OB.DAAC Data Access</em>.</p>
<p>Minimum input to the <em>AEC.run</em> function includes a path to satellite files and EarthData credentials. See <a href="https://tmart-rtm.github.io/tmart.html#module-tmart.AEC.run" target="_blank">AEC.run Function</a> for all the arguments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tmart</span>
<span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;user/test/S2A_MSIL1C_20160812T143752_N0204_R096_T20MKB_20160812T143749.SAFE&#39;</span>
<span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;abcdef&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;123456&#39;</span>

<span class="c1"># T-Mart uses multiprocessing, which must be wrapped in &#39;if __name__ == &quot;__main__&quot;:&#39; for Windows users. This is optional for Unix-based systems</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">tmart</span><span class="o">.</span><span class="n">AEC</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="overwrite-existing-files">
<h2>Overwrite existing files<a class="headerlink" href="#overwrite-existing-files" title="Link to this heading"></a></h2>
<p>By default, the processing creates a copy of the original satellite files in the same directory, in a new folder named ‘AEC_*’. To overwrite the eixsting files, add ‘overwrite=True’ to the arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tmart</span><span class="o">.</span><span class="n">AEC</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="ancillary-and-log-files">
<h2>Ancillary and log files<a class="headerlink" href="#ancillary-and-log-files" title="Link to this heading"></a></h2>
<p>During the AEC process, a number of files are generated:</p>
<ul class="simple">
<li><p><strong>tmart_log_*.txt</strong>: detailed processing information, as printed in the Python console.</p></li>
<li><p><strong>tmart_atm_info_*.txt</strong>: atmosphere and aerosol information used in the processing. This includes aerosol type, angstrom exponent, single scattering albedo, AOT at 550 nm, total column ozone, and total precipitable water vapour.</p></li>
<li><p><strong>tmart_ancillary/*.nc</strong>: GMAO MERRA2 ancillary files from the NASA Ocean Biology Processing Group.</p></li>
<li><p><strong>AEC_completed_*.txt</strong>: a record of bands that have been corrected for the adjacency effect.</p></li>
<li><p><strong>tmart_preview.png</strong>: an image preview of pixels identified as water (only run when <code class="docutils literal notranslate"><span class="pre">AE_land</span></code> is False).</p></li>
</ul>
</section>
<section id="aec-configuration">
<h2>AEC configuration<a class="headerlink" href="#aec-configuration" title="Link to this heading"></a></h2>
<p>A TXT configuration file is stored in the <em>tmart</em> package folder. Its path is printed in the Python console and the log file. Brief descriptions are given in the file. Most of the configuration settings are tuned for best performance.</p>
<p>By default, T-Mart identifies water pixels and only modify their values, leaving land pixel values unchanged to facilitate the existing calibration of atmospheric correction processors that extract information from land pixels. In case a significant number of water pixels are falsely masked as land, the <code class="docutils literal notranslate"><span class="pre">mask_SWIR_threshold</span></code> (the reflectance threshold in a SWIR band used to mask non-water pixels; default value: 0.03) can be increased based on the water pixel values in the scene. Modifying <code class="docutils literal notranslate"><span class="pre">mask_SWIR_threshold</span></code> in the <em>AEC.run</em> function overwrites the value in config.txt. Alternatively, setting <code class="docutils literal notranslate"><span class="pre">AE_land</span></code> to True enables AEC across the entire scene.</p>
</section>
<section id="additional-arguments">
<h2>Additional arguments<a class="headerlink" href="#additional-arguments" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">AOT</span></code> and <code class="docutils literal notranslate"><span class="pre">n_photon</span></code> can be specified manually. <code class="docutils literal notranslate"><span class="pre">AOT</span></code> is the aerosol optical thickness at 550 nm, you can specify it if you are certain about its value or simply to test the impact of using different values. <code class="docutils literal notranslate"><span class="pre">n_photon</span></code> is the number of photons used in each T-Mart run; the default value of 100,000 is recommended for accurate results. It can be reduced to 10,000 for quicker computation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tmart</span><span class="o">.</span><span class="n">AEC</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">AOT</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">n_photon</span> <span class="o">=</span> <span class="mi">10_000</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="user-input-atmospheric-information">
<h2>User-input atmospheric information<a class="headerlink" href="#user-input-atmospheric-information" title="Link to this heading"></a></h2>
<p>Alternative to retrieving atmospheric parameters from NASA EarthData, users may provide a custom atmospheric information file via the <code class="docutils literal notranslate"><span class="pre">atm_info_file</span></code> argument.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">atm_info_file</span></code> is supplied, the parameters are read directly from the text file and the EarthData credentials (<code class="docutils literal notranslate"><span class="pre">username</span></code>, <code class="docutils literal notranslate"><span class="pre">password</span></code>) are no longer required. You may copy an existing <code class="docutils literal notranslate"><span class="pre">tmart_atm_info_*.txt</span></code> file generated by a previous run and edit the values manually.</p>
<p>How parameters in the file are used:</p>
<ul class="simple">
<li><p><strong>Aerosol mixing ratio</strong>: The ratio of maritime aerosol in the maritime/continental mixture is always read directly from the file and used in the simulation.</p></li>
<li><p><strong>Aerosol Angstrom exponent and single-scattering albedo</strong>: These two are ignored when an input file is provided. They are only used internally to derive the aerosol mixing ratio when EarthData is queried. If a file is supplied, the ratio in the file is used as-is.</p></li>
<li><p><strong>AOT</strong>: The AOT value in the file is used only when <code class="docutils literal notranslate"><span class="pre">AOT=&quot;MERRA2&quot;</span></code>. Otherwise, the value specified by <code class="docutils literal notranslate"><span class="pre">AOT=&lt;float&gt;</span></code> is used.</p></li>
<li><p><strong>Ozone and water vapour</strong>: Total column ozone and water vapour must be provided in the file and are always read from it when <code class="docutils literal notranslate"><span class="pre">atm_info_file</span></code> is specified.</p></li>
</ul>
<p>Example content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ratio</span> <span class="n">of</span> <span class="n">maritime</span> <span class="n">aerosol</span> <span class="ow">in</span> <span class="n">maritime</span><span class="o">/</span><span class="n">continental</span> <span class="n">mixture</span><span class="p">:</span> <span class="mf">0.32149729438202934</span>
<span class="n">Aerosol</span> <span class="n">angstrom</span> <span class="n">exponent</span><span class="p">:</span> <span class="mf">1.1694952659402162</span>
<span class="n">Aerosol</span> <span class="n">single</span> <span class="n">scattering</span> <span class="n">albedo</span><span class="p">:</span> <span class="mf">0.9274053986128525</span>
<span class="n">AOT550</span><span class="p">:</span> <span class="mf">0.07811043870567436</span>
<span class="n">Total</span> <span class="n">column</span> <span class="n">ozone</span><span class="p">:</span> <span class="mf">264.1938889212531</span> <span class="n">DU</span>
<span class="n">Total</span> <span class="n">precipitable</span> <span class="n">water</span> <span class="n">vapour</span><span class="p">:</span> <span class="mf">19.350930129831248</span> <span class="n">kg</span> <span class="n">m</span><span class="o">-</span><span class="mi">2</span>
</pre></div>
</div>
<p>Example usage without credentials:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tmart</span><span class="o">.</span><span class="n">AEC</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">atm_info_file</span><span class="o">=</span><span class="s2">&quot;tmart_atm_info_example.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This allows fully offline processing with user control over the atmospheric state.</p>
</section>
<section id="assumptions-in-aec">
<h2>Assumptions in AEC<a class="headerlink" href="#assumptions-in-aec" title="Link to this heading"></a></h2>
<p>A few assumptions are made in the processing, violations can lead to various degrees of errors in the output AE-free product:</p>
<ul class="simple">
<li><p>Isotropic/Lambertian surface</p></li>
<li><p>Vertically stratified but horizontally homogeneous atmospheric molecules and aerosols across the scene</p></li>
<li><p>Flat surface or lack of topography</p></li>
</ul>
<p>See <a href="https://tmart-rtm.github.io/tmart.html#module-tmart.AEC.run" target="_blank">AEC.run Function</a> for all the arguments.</p>
</section>
<section id="prisma-image-processing">
<h2>PRISMA image processing<a class="headerlink" href="#prisma-image-processing" title="Link to this heading"></a></h2>
<p>T-Mart supports AE correction for ACOLITE-generated L1R PRISMA files. The modified L1R files from T-Mart can then be reprocessed in ACOLITE for atmospheric correction.</p>
</section>
<section id="video-tutorials">
<h2>Video tutorials<a class="headerlink" href="#video-tutorials" title="Link to this heading"></a></h2>
<p><a href="https://youtube.com/playlist?list=PLzHfjrsxuGd0LnpNDYCqbo9PEnit9fDeT&si=ebnYU7Lq-OJSVtWJ" target="_blank"><img src="https://raw.githubusercontent.com/yulunwu8/tmart/main/files/playlist.png"  width="300"></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ins_basic.html" class="btn btn-neutral float-right" title="Instruction - Basic Modelling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Yulun Wu.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>